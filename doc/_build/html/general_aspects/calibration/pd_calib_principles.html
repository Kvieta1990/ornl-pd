
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Principles &#8212; Powder Diffraction at ORNL</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=44323870" />
    <link rel="stylesheet" type="text/css" href="../../_static/.ipynb_checkpoints/custom-checkpoint.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TFL7TZY8LR"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TFL7TZY8LR');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TFL7TZY8LR');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'general_aspects/calibration/pd_calib_principles';</script>
    <script data-website-id="3fc28470-259d-4b4f-bf0c-d4635edb6515" src="https://umm.iris-home.net/script.js"></script>
    <link rel="canonical" href="https://powder.ornl.gov/general_aspects/calibration/pd_calib_principles.html" />
    <link rel="icon" href="../../_static/powder_fav.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Instrument Calibration Files" href="instrument_files.html" />
    <link rel="prev" title="Calibration of Instruments" href="toc.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/ornl_logo.png" class="logo__image only-light" alt="Powder Diffraction at ORNL - Home"/>
    <script>document.write(`<img src="../../_static/ornl_logo.png" class="logo__image only-dark" alt="Powder Diffraction at ORNL - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../about_this_book.html">About this book</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">General Topics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../nsources.html">Neutron Sources</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="toc.html">Calibration of Instruments</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Principles</a></li>
<li class="toctree-l2"><a class="reference internal" href="instrument_files.html">Instrument Calibration Files</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data_acquire/toc.html">Data Acquisition</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_acquire/monitor.html">Data Monitor</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../catalogue/toc.html">Data Catalog</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../catalogue/oncat.html">ONCAT Catalog</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bragg Diffraction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../bragg_diffraction/intro.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../bragg_diffraction/data_reduction/toc.html">Data Reduction</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_reduction/hb2a.html">POWDER | HB-2A | HFIR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_reduction/hb2c.html">WAND² | HB-2C | HFIR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_reduction/nomad.html">NOMAD | BL-1B | SNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_reduction/powgen.html">POWGEN | BL-11A | SNS</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../bragg_diffraction/data_analysis/toc.html">Data Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_analysis/software.html">Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bragg_diffraction/data_analysis/tutorials.html">Tutorials &amp; Workshops</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Total Scattering</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../total_scattering/intro.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../total_scattering/data_reduction/toc.html">Data Reduction</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../total_scattering/data_reduction/princple_implementation.html">Principle &amp; Implementation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../total_scattering/data_reduction/mts_flow.html">MTS workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../total_scattering/data_reduction/mts_abs_ms.html">Absorption and Multiple Scattering Correction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_reduction/dr_howto.html">Data Reduction How-to</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_reduction/ts_powgen.html">For POWGEN Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_reduction/mts_doc.html">MTS Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_reduction/ts_pp.html">Post-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_reduction/ts_dp_workshops.html">Data Processing Workshops</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../total_scattering/data_analysis/toc.html">Data Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../total_scattering/data_analysis/software.html">Software</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Auto Reduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../auto_reduce/hb2a_auto.html">POWDER | HB-2A | HFIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_reduce/hb2c_auto.html">WAND² | HB-2C | HFIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_reduce/nomad_auto.html">NOMAD | BL-1B | SNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../auto_reduce/powgen_auto.html">POWGEN | BL-11A | SNS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Toolbox</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../data_tools/nomad.html">NOMAD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_tools/powgen.html">POWGEN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_tools/hb2a.html">HB-2A (POWDER)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_tools/hb2c.html">HB-2C (WAND<span class="math notranslate nohighlight">\(^2\)</span>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_tools/general.html">General Tools</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">More</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../uptime.html">Services Monitor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../addie.html">ADDIE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../powder_forum.html">Discussion Forum</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../run_time.html">Data reduction running time</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../work_items/toc.html">Powder Diffraction Work Items</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../work_items/roadmap.html">Roadmap</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../work_items/software_and_projects.html">Community Software and Projects</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../collections/toc.html">Powder Diffraction Collections</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collections/mts_for_developers.html">MTS Collections for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collections/mobile_apps.html">Mobile Apps for SNS &amp; HFIR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bib.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../follow.html">Follow Us</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/Kvieta1990/ornl-pd/main?urlpath=tree/doc/general_aspects/calibration/pd_calib_principles.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://powder.ornl.gov/hub/hub/user-redirect/git-pull?repo=https%3A//github.com/Kvieta1990/ornl-pd&urlpath=tree/ornl-pd/doc/general_aspects/calibration/pd_calib_principles.ipynb&branch=main" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/Kvieta1990/ornl-pd/blob/main/doc/general_aspects/calibration/pd_calib_principles.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Kvieta1990/ornl-pd" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Kvieta1990/ornl-pd/edit/main/doc/general_aspects/calibration/pd_calib_principles.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Kvieta1990/ornl-pd/issues/new?title=Issue%20on%20page%20%2Fgeneral_aspects/calibration/pd_calib_principles.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/general_aspects/calibration/pd_calib_principles.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Principles</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hfir">HFIR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto">Howto</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sns">SNS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-principle">Howto - principle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-nomad">Howto - NOMAD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-powgen">Howto - POWGEN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibration-some-notes">Calibration - Some Notes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Usage</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="principles">
<h1>Principles<a class="headerlink" href="#principles" title="Link to this heading">#</a></h1>
<section id="hfir">
<h2>HFIR<a class="headerlink" href="#hfir" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>This section covers the calibration for HFIR powder diffraction instruments, including HB-2A and HB-2C.This section covers the calibration for HFIR powder diffraction instruments, including HB-2A and HB-2C.</p>
</div></blockquote>
<section id="howto">
<h3>Howto<a class="headerlink" href="#howto" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>A side note would be that for constant wavelength (CW) instruments, the calibration can be vaguely considered as part of the data analysis step. The reason is that in terms of technical barrier, it is relatively easier for general users or instrument scientists to grab the diffraction data for those standard samples, load them into a Ritveld program and perform the calibration, by releasing those calibration relevant parameters (e.g., zero offset). This is in contrast to the calibration for time-of-flight (TOF) instruments, as to be discussed in details in the section below.</p>
</div></blockquote>
<p>For both HB-2A and HB-2C, they are running the constant wavelength mode, and specifically they have the monochromator wavelength as follows,</p>
<ul class="simple">
<li><p>HB-2A: 1.54 Å, 2.41 Å, 1.12 Å (Information can be found <a class="reference external" href="https://neutrons.ornl.gov/powder">https://neutrons.ornl.gov/powder</a>)</p></li>
<li><p>HB-2C: 1.5 Å, 0.95 Å (Information can be found at <a class="reference external" href="https://neutrons.ornl.gov/wand">https://neutrons.ornl.gov/wand</a>)</p></li>
</ul>
<p>Both instruments then use standard sample to perform the calibration in Rietveld programs (Fullprof, GSAS, and GSAS-II) to generate the instrument parameter, which not only contains the calibration constant but also hosts the instrument peak profile information. Specifically,</p>
<ul class="simple">
<li><p>HB-2A has been using multiple standard samples as the calibrants, namely Si, Lab6, and NAC (Na2Al2Ca3F14). The instrument parameter files suitable for multiple Rietveld programs for those various calibrants can be found at <a class="reference external" href="https://neutrons.ornl.gov/powder/users">https://neutrons.ornl.gov/powder/users</a>.</p></li>
<li><p>HB-2C has been using Si as the calibrant, and also the instrument parameter files for various Rietveld programs are provided, as can be found at <a class="reference external" href="https://neutrons.ornl.gov/wand/users">https://neutrons.ornl.gov/wand/users</a>.</p></li>
</ul>
</section>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Link to this heading">#</a></h3>
<p>On the user side, it is expected that the instrument parameter files should be delivered to them together with the user data so that they can import those instrument parameter file in relevatnt Rietveld programs to conduct the refinement. At this point, specifically for CW data, the main wavelength (corresponding to the monochromator used during the experiment) should be read in from the instrument parameter file, leaving the zero offset refinable.</p>
</section>
</section>
<section id="sns">
<h2>SNS<a class="headerlink" href="#sns" title="Link to this heading">#</a></h2>
<blockquote>
<div><p>This section covers the calibration for SNS powder diffraction instruments, including NOMAD and POWGEN.</p>
</div></blockquote>
<section id="howto-principle">
<h3>Howto - principle<a class="headerlink" href="#howto-principle" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Compared to constant wavelength (CW) instruments, the calibration for time-of-flight (TOF) instruments is a bit more complicated. The main reason is that both NOMAD and POWGEN are not only generating Bragg diffraction data but also at the same time they would be used to produce the total scattering data (the Fourier transform of which would yield the pair distribution function (PDF) for probing the local structure of materials). The comlexity in terms of calibration then comes on the total scattering side, as detailed below.</p>
</div></blockquote>
<blockquote>
<div><p>The principle covered in the context below applies to both NOMAND and POWGEN – it fact, it should be applied in general to all the powder TOF diffractometers, at least in principle. However, for the moment, the implementation is only done on NOMAD. For POWGEN, the calibration routine will be covered in its own dedicated section below.</p>
</div></blockquote>
<p>The calibration for NOMAD and POWGEN can be roughly separated into two scenarios – one for the generation of total scattering data and the other for the Bragg diffraction pattern. For the Bragg part, the mechanism of calibration is similar to that for CW instruments, in terms of technical operation. First, a standard sample (Si, Lab6, or NAC) needs to be measured and the corresponding Bragg pattern would be loaded into Rietveld program where the calibration parameters would be released for being refined, including the DIFC, DIFA, TZERO parameters (specifically for POWGEN, one also has an extra DIFB parameter). The refined calibration constants for various banks (on NOMAD, usuaslly the physical banks would be used to group the spectra from the individual detectors whereas for POWGEN, usually there is only one bank) would then be written into the instrument parameter file along with those instrument peak profile parameters.</p>
<p>On the total scattering side, the calibration is more of a part of the data reduction process since it is a prerequisite to produce the total scattering in <span class="math notranslate nohighlight">\(Q\)</span>-space (followed by the Fourier transform to produce the PDF). The principle of calibration stays the same – a standard sample would be measured and the TOF-to-<span class="math notranslate nohighlight">\(d\)</span> transformation relation would be constructed against those known peak positions in <span class="math notranslate nohighlight">\(d\)</span>-space. Usually, a diamond sample would be used for such a calibration purpose on both NOMAD and POWGEN, since the sharp and strong diamond diffraction peaks makes it easy to perform the peak fitting for extracting the peak position accurately. In practice, a generic routine has been designed to routinely calibrate the instrument, by performing sequentially an automatic grouping of pixels (using an unsupervised clustering algorithm), cross correlation, and the actual calibration steps. The automatic grouping step can be summarized as below,</p>
<img src="../../imgs/calib_grouping.png" alt="drawing" width="1200"/>
<p>where the scattering patterns from all detectors would be clustered into different groups so that each group contains patterns as similar to each other as possible. The purpose of such an automatic grouping step is for identifying the outlier pixels (thus considered being masked). Depending on the clustering algorithm being used, the way of pixels being identified as outliers is a bit different. For example, with <code class="docutils literal notranslate"><span class="pre">KMEANS</span></code> method, all pixels will be included in the final grouping (thus no outliers by default). In this case, if we increase the number of groups to be identified, we would have groups with few pixels generated, and if we set a upper limit for the acceptable number of pixels in a single group, we could mask all the pixels involved in those groups with the number of pixels smaller than the specified threshold.</p>
<p>Next, the diamond (220) peak will be used as the reference, and we will first calculate the offset of the corresponding peak for each pixel, as compared to the nominal diamond (220) peak position. The offset then could be translated into an effective DIFC value and be applied to the loaded diamond dataset. Converting unit to d-space using this updated DIFC value should give one an initial calibrated lining-up of all the pixels.# Using the diamond (220) peak as the reference , we will first calculate the offset of the corresponding peak for each pixel. The offset then could be translated into an effective DIFC value and be applied to the loaded diamond dataset. Converting unit to d-space using this updated DIFC value should give one an initial calibrated lining-up of all the pixels, as demonstrated in the picture below,</p>
<img src="../../imgs/calib_cc.png" alt="drawing" width="1200"/>
<blockquote>
<div><p>The lattice parameter for diamond at room temperature was calculated from the following paper:</p>
</div></blockquote>
<blockquote>
<div><p>DOI: 10.1103/PhysRevLett.104.085901</p>
</div></blockquote>
<blockquote>
<div><p>The value was calculated to be 3.5671299351 angstrom and accordingly the nominal position of diamond (hkl) peaks can be calculated following formula, d_spacing = latt / sqrt(h^2 + k^2 + l^2)</p>
</div></blockquote>
<p>The final stage of the generic calibration routine is to bring the peak position of the focused pattern to its nominal position. This step involves the peak fitting (multiple peaks could be used) to extract the peak position in TOF-space, and then by comparing to the nominal peak positions of the standard sample, the TOF-to-<span class="math notranslate nohighlight">\(d\)</span> transformation relation could be established using a combination of parameters including DIFA, DIFC, and TZERO parameters, by assuming the following relation between TOF and <span class="math notranslate nohighlight">\(d\)</span>,</p>
<p>As a showcase, the following picture is showing the result of applying such a generic calibration routine on NOMAD (left – alignment of pixels using the engineering values, i.e., <span class="math notranslate nohighlight">\(L_1\)</span>, <span class="math notranslate nohighlight">\(L_2\)</span> and scattering angle, right – alignment after calibration),</p>
<img src="../../imgs/calib_final.png" alt="drawing" width="1200"/>
<p>As a quantitative diagnostic, the following figure is showing the difference between the calibrated and nominal diamond peak positions – here we are taking NOMAD as the demo case and the result shown is for the back scattering bank (which is with the highest resolution among all the 6 physical banks),</p>
<img src="../../imgs/Bank_5_d_calib_d_norm_diff.png" alt="drawing" width="1200"/>
<p>Also shown here is the uncertainty of the fitted calibration constants versus banks,</p>
<img src="../../imgs/Calib_const_uncertainty.png" alt="drawing" width="1200"/><blockquote>
<div><p>The diagnostics plots in practice will be automatically generated at the autoreduction stage and will be posted automatically to the monitor website for inspection purpose, as demonstrated below,</p>
</div></blockquote>
<img src="../../imgs/calib_diag_mon.gif" alt="drawing" width="1200"/>
<blockquote>
<div><p>Due to technical reasons, the diagnostics plots will not be automatically posted at the autoreduction stage for the diamond run, though, the calibration file (the H5 file containing the calibration constants) could be generated without any problems at this stage. As a workaround, the diagnostics plot will be generated and posted automatically at the autoreduction stage for samples runs that a certain diamond run is associated with. Alternatively, one can manually generate and diagnostics plots once the calibration file is ready, by going to the monitor web page for a certain diamond run (see the right-hand side of the GIF above) and clicking on the <code class="docutils literal notranslate"><span class="pre">reduction</span></code> link at the bottom of the page. In this case, the autoreduction routine will read in the existing calibration file, generate and post the corresponding diagnostics plots.</p>
</div></blockquote>
</section>
<section id="howto-nomad">
<h3>Howto - NOMAD<a class="headerlink" href="#howto-nomad" title="Link to this heading">#</a></h3>
<p>The calibration routine for NOMAD, together with the configuration and resulted calibration files, can be found at <code class="docutils literal notranslate"><span class="pre">/SNS/NOM/shared/CALIBRATION</span></code> on ORNL analysis cluster. The routine file name is <code class="docutils literal notranslate"><span class="pre">nom_cal</span></code> under <code class="docutils literal notranslate"><span class="pre">/SNS/NOM/shared/CALIBRATION</span></code> which is a bash script calling all the sub-routinesd concerning the several stages of the calibration as detailed above. To run the calibration routine from a terminal, one should first change directory to <code class="docutils literal notranslate"><span class="pre">/SNS/NOM/shared/CALIBRATION</span></code> and execute <code class="docutils literal notranslate"><span class="pre">./nom_cal</span></code>. During the calibration routine running, the configuration file <code class="docutils literal notranslate"><span class="pre">cal_config.json</span></code> (sitting in the same location as <code class="docutils literal notranslate"><span class="pre">nom_cal</span></code>) will be read in to provide necessary input parameters for running the calibration. An example configuration file is shown below,</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Diamond&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/SNS/NOM/IPTS-31346/nexus/NOM_192520.nxs.h5&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Instrument&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NOM&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-14&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SampleEnv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shifter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OutputDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/SNS/NOM/shared/CALIBRATION/autoreduce&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;DiaLattParam&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.5671299351</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;GenShadowMask&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shadow_mask_shifter_192520.in&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;GroupMethod&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;KMEANS_ED&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SaveInitCalTable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Quiet&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ArbCalFile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arb_starting_cal.h5&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;MaskFile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;outputmask.xml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The entries should be self-explaining and there are several things worth special mentioning. First, the <code class="docutils literal notranslate"><span class="pre">Instrument</span></code>, <code class="docutils literal notranslate"><span class="pre">Date</span></code> and <code class="docutils literal notranslate"><span class="pre">SampleEnv</span></code> entries will be used in the name of the finally resulted calibration file (which will be saved under the directory specified by the <code class="docutils literal notranslate"><span class="pre">OutputDir</span></code> entry) and therefore their corresponding values should <code class="docutils literal notranslate"><span class="pre">NOT</span></code> contain spaces. Second, the <code class="docutils literal notranslate"><span class="pre">DiaLattParam</span></code> entry specifies the lattice parameter of the diamond standard sample and its value comes from Ref. <span id="id1">[<a class="reference internal" href="../../bib.html#id9" title="Stanislav Stoupin and Yuri V. Shvyd'ko. Thermal expansion of diamond at low temperatures. Phys. Rev. Lett., 104:085901, Feb 2010. URL: https://link.aps.org/doi/10.1103/PhysRevLett.104.085901, doi:10.1103/PhysRevLett.104.085901.">Stoupin and Shvyd'ko, 2010</a>]</span>. This entry should <code class="docutils literal notranslate"><span class="pre">NOT</span></code> be touched <em>unless</em> the calibrant is changed to another type of standard material. During the calibration running, apart from those masks generated automatically at the intermediate steps of the calibration, the extra shadow masks will also be generated, for masking out those pixels in the shadow of the instrument setup – usually, due to the shadowing effect from the sample environment setup, the intensity of those shadowed pixels is lower than their adjacent pixels which are not shadowed. Here, a script written in <code class="docutils literal notranslate"><span class="pre">R</span></code> is introduced to automatically identify those shadowed pixels according to the overall integrated intensity and the resulted mask will be saved to the file specified by the <code class="docutils literal notranslate"><span class="pre">GenShadowMask</span></code> entry. The <code class="docutils literal notranslate"><span class="pre">GroupMethod</span></code> tells the method of grouping pixels – the front part (<code class="docutils literal notranslate"><span class="pre">KMEANS</span></code> in the example above) indicates the method of clustering and the end part (<code class="docutils literal notranslate"><span class="pre">ED</span></code> in the example above) specifies the method of building the similarity matrix. For the clustering method, another option beyond <code class="docutils literal notranslate"><span class="pre">KMEANS</span></code> is <code class="docutils literal notranslate"><span class="pre">DBSCAN</span></code>. For the similarity matrix building method, <code class="docutils literal notranslate"><span class="pre">ED</span></code> means the Euclidean distance in the parameter space (parameters of all the involved diffraction peaks, such as peak position, peak width, etc.). There are other two options – <code class="docutils literal notranslate"><span class="pre">CC</span></code> for cross correlation and <code class="docutils literal notranslate"><span class="pre">DG</span></code> for de Gelder method <span id="id2">[<a class="reference internal" href="../../bib.html#id10" title="Peter F. Peterson, Daniel Olds, Andrei T. Savici, and Wenduo Zhou. Advances in utilizing event based data structures for neutron scattering experiments. Review of Scientific Instruments, 89(9):093001, 09 2018. URL: https://doi.org/10.1063/1.5034782, arXiv:https://pubs.aip.org/aip/rsi/article-pdf/doi/10.1063/1.5034782/16758706/093001\_1\_online.pdf, doi:10.1063/1.5034782.">Peterson <em>et al.</em>, 2018</a>]</span>. In practice, only the <code class="docutils literal notranslate"><span class="pre">ED</span></code> method is recommended since the other two methods are both very slow for the calibration purpose, which involves hundreds of thousands of pixels. The <code class="docutils literal notranslate"><span class="pre">SaveInitCalTable</span></code> entry tells whether or not to save the initial calibration table which corresponds to the first stage of the calibration, i.e., lining pixel up with reference to a single diamond peak. The <code class="docutils literal notranslate"><span class="pre">Quiet</span></code> option is always recommended to set to <code class="docutils literal notranslate"><span class="pre">true</span></code> which will suppress the terminal output when running the calibration – this is helpful for reducing the running time and should <code class="docutils literal notranslate"><span class="pre">ONLY</span></code> be set to <code class="docutils literal notranslate"><span class="pre">false</span></code> when debugging. The <code class="docutils literal notranslate"><span class="pre">ArbCalFile</span></code> is a file under <code class="docutils literal notranslate"><span class="pre">/SNS/NOM/shared/CALIBRATION/inputs</span></code> directory which gives an initial calibration file. The purpose of this is only to provide a starting calibration as needed by the Mantid <a class="reference external" href="https://docs.mantidproject.org/v6.7.0/algorithms/PDCalibration-v1.html"><code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code></a> algorithm. This file can be shared among different sample environments and should not matter that much with regard to the final calibration result and thus can be left unchanged safely. The <code class="docutils literal notranslate"><span class="pre">MaskFile</span></code> entry specifies the file name of the final masks being generated and accumulated along the whole calibration process.</p>
<p>The calibration can be run independently but only the NOMAD team or whoever has write access to the <code class="docutils literal notranslate"><span class="pre">/SNS/NOM/shared/CALIBRATION</span></code> directory can run it. Meanwhile, it will also run automatically with the autoreduction routine. Once a diamond measurement is detected at the autoreduction stage, the calibration routine will be run and diagnostics (as presented above) will be automatically generated and posted to the ORNL monitor web page corresponding to the specific diamond run.</p>
</section>
<section id="howto-powgen">
<h3>Howto - POWGEN<a class="headerlink" href="#howto-powgen" title="Link to this heading">#</a></h3>
<p>The calibration for POWGEN purely relies on the Mantid <a class="reference external" href="https://docs.mantidproject.org/v6.7.0/algorithms/PDCalibration-v1.html"><code class="docutils literal notranslate"><span class="pre">PDFCalibration</span></code></a> algorithm. Several stages in the routine discussed above are omitted, including the auto-grouping and initial pixel lining-up stages. One can refer to the link to the <a class="reference external" href="https://docs.mantidproject.org/v6.7.0/algorithms/PDCalibration-v1.html"><code class="docutils literal notranslate"><span class="pre">PDFCalibration</span></code></a> algorithm for more details. The fundamental principle is to take the nominal positions of the calibration diffraction peaks in <span class="math notranslate nohighlight">\(d\)</span>-space, fit peak positions in TOF-space and then extract the calibration constants through TOF-<span class="math notranslate nohighlight">\(d\)</span> fitting for the values corresponding multiple peaks involved in the calibration process.</p>
<p>The calibration routine, configurations and the resulted calibration files can be found at <code class="docutils literal notranslate"><span class="pre">/SNS/PG3/shared/CALIBRATION</span></code> on ORNL analysis cluster. The routine is stored in the file <code class="docutils literal notranslate"><span class="pre">pg3_cal.py</span></code> and can be executed from the command line by running <code class="docutils literal notranslate"><span class="pre">mantidpython</span> <span class="pre">pg3_cal.py</span></code> (assuming one is located in the <code class="docutils literal notranslate"><span class="pre">/SNS/PG3/shared/CALIBRATION</span></code> directory on the command line). The routine will read in the configuration file <code class="docutils literal notranslate"><span class="pre">cal_config.json</span></code> in the same location as <code class="docutils literal notranslate"><span class="pre">pg3_cal.py</span></code>. The configuration file contains the key information for the calibration process, of which a typical example is presented below,</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Diamond&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/SNS/PG3/IPTS-2767/nexus/PG3_55064.nxs.h5&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;RunCycle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-1_11A_CAL&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Instrument&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PG3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-02-14&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SampleEnv&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MAG-He3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;OutputDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/SNS/PG3/shared/CALIBRATION/autoreduce&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;PDCalibration&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;TofBinningFirst&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300,-0.0008,16667&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;TofBinningSecond&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300,-0.0005,16667&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;TofBinningThird&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;300,-0.0003,16667&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;ConstrainPeakPositions&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;MaxPeakWindow&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.075</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;MinimumPeakHeight&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.0</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;PeakWidthPercent&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.008</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;TZEROrange&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0,10&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;ManualMaskFile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2018_2_11A_CAL/mask/PG3_40481_manual_mask.xml&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The entries should be self-explaining and there are several things worth special mentioning. First, the <code class="docutils literal notranslate"><span class="pre">RunCycle</span></code> entry specifies the location under the output directory (as specified by the <code class="docutils literal notranslate"><span class="pre">OutputDir</span></code> entry) where the resulted calibration file will be saved and its value should <code class="docutils literal notranslate"><span class="pre">NOT</span></code> contain spaces. The <code class="docutils literal notranslate"><span class="pre">Instrument</span></code>, <code class="docutils literal notranslate"><span class="pre">Date</span></code>, <code class="docutils literal notranslate"><span class="pre">SampleEnv</span></code> and <code class="docutils literal notranslate"><span class="pre">Notes</span></code> entries will be used to specify the name of the resulted calibration file and all the corresponding values should <code class="docutils literal notranslate"><span class="pre">NOT</span></code> contain spaces and should be kept as short as possible. The <code class="docutils literal notranslate"><span class="pre">Notes</span></code> entry can be left as is shown if there is no special notes concerning a certain calibration. The <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code> entry specifies the parameters for the <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code> algorithm and one can refer to the Mantid documentation for <a class="reference external" href="https://docs.mantidproject.org/v6.7.0/algorithms/PDCalibration-v1.html"><code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code></a> for details. The <code class="docutils literal notranslate"><span class="pre">ManualMaskFile</span></code> specifies the manual mask which will be merged with the automatically generated masks by <code class="docutils literal notranslate"><span class="pre">PDCalibration</span></code> to compose the final mask.</p>
<p>Once the calibration roution is successfully executed, the corresponding diagnostics plots will be automatically generated and posted to the SNS monitor web page corresponding to the diamond run being used for the calibration. Here is an example,</p>
<img src="../../imgs/powgen_cal_diag.gif" alt="drawing" width="1200"/>
<p>and the corresponding web page is <a class="reference external" href="https://monitor.sns.gov/report/pg3/55064/">https://monitor.sns.gov/report/pg3/55064/</a>.</p>
<p>Going one step further, the calibration routine has been incorporated into the POWGEN autoreduction routine. When a diamond run is identified in the autoreduction stage, the normal data reduction step will be skipped and instead the calibration routine will be started. The designed scenario is all the necessary inputs needed by the calibration routine will be collected and populated into the <code class="docutils literal notranslate"><span class="pre">cal_config.json</span></code> file mentioned above and the calibration routine will be called as a subprocess from within the autoreduction routine.</p>
</section>
<section id="calibration-some-notes">
<h3>Calibration - Some Notes<a class="headerlink" href="#calibration-some-notes" title="Link to this heading">#</a></h3>
<ol class="arabic">
<li><p>The current calibration routine is <strong>ONLY</strong> for establishing the TOF-to-<span class="math notranslate nohighlight">\(d\)</span> transformation, i.e., the actual engineering value is still not calibrated. Specifically, one can refer to the following equations,</p>
<p><span class="math notranslate nohighlight">\(\lambda = \frac{h}{p} = \frac{h}{m\frac{L_{tot}}{TOF}}\)</span></p>
<p><span class="math notranslate nohighlight">\(2d\,sin\theta = \lambda = \frac{h}{m\frac{L_{tot}}{TOF}} \Rightarrow DIFC = \frac{TOF}{d} = \frac{2mL_{tot}sin\theta}{h}\)</span></p>
<p>where it can be clearly seen that knowing the DIFC value is not enough to disentangle <span class="math notranslate nohighlight">\(L_{tot}\)</span> (the total flying path) and <span class="math notranslate nohighlight">\(\theta\)</span> (the scattering angle).</p>
</li>
<li><p>There is one potential issue with the current calibration routine. When the sample position is not identical to that of the calibrant, the calibration constant obtained via calibrating against the calibrant would not be applicable to the sample since, according to the equations above, the change of the flying path and scattering angle would invalidate the established TOF-to-<span class="math notranslate nohighlight">\(d\)</span> transformation that was constructed for the calibrant (and only for the calibrant in such a situation). As such, some extra efforts are needed to account for the potential sample position shift as compared to the calibrant. One dirty method is to learn from the Bragg calibration routine. In a normal Bragg calibration setup, additional calibration parameters such as DIFA and TZERO are introduced to account for the potential sample position shift. With this regard, a GUI program called <code class="docutils literal notranslate"><span class="pre">sofq_calib</span></code> (see the demo video attached below) with wxPython framework has been developed to further calibrate the total scattering pattern against the Bragg refinement result. Through this further calibration step, a common TOF-<span class="math notranslate nohighlight">\(d\)</span> transformation is shared between the total scattering and Bragg data. The GUI was released as a conda package and could be installed conveniently via conda. Detailed instructions about the installation together with documentation of usage could be found at <a class="reference external" href="https://rmc-adv-tools.readthedocs.io/en/main/rmc_tools/sofq_calib.html">https://rmc-adv-tools.readthedocs.io/en/main/rmc_tools/sofq_calib.html</a>. In the future, we plan to develop a machine learning algorithm to post-calibrate the instrument according to the relative peak shift across individual detectors. Through such a process, it is expected that one can deduce the sample shift as compared to the calibrant so that the total scattering data of the sample can be calibrated more accurately. There is still some ongoing discussion about this.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;D8mY7k8MAIk&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">720</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="720"
            height="500"
            src="https://www.youtube.com/embed/D8mY7k8MAIk"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="id3">
<h3>Usage<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>The usage of the calibration for powder TOF instruments (specifically, NOMAD and POWGEN in current scope) is two-fold, in line with the discussion presented in the sub-section above. On the Bragg side, the scenario is quite similar to that for CW instruments, i.e., the instrument parameter file containing the calibration constants will be delivered to genernal users. At the stage of data analysis, the main DIFC constant should be fixed and in most cases, the DIFA and TZERO values (and, potentially the DIFB parameter for POWGEN) can be released to be refined, to account for the potential sample position shift, etc.</p>
<p>On the total scattering side, although, as discussed in previous sub-section, the exact flying path, scattering angle, and among other engineering parameters (e.g., detector location) are still unknown after the calibration process, total scattering pattern with correct <span class="math notranslate nohighlight">\(Q\)</span> (or <span class="math notranslate nohighlight">\(d\)</span>) assignment can still be constructed. However, as discussed in previous sub-section, the prerequisite condition for an accurate <span class="math notranslate nohighlight">\(Q\)</span> or <span class="math notranslate nohighlight">\(d\)</span> assignment is that the potential sample position shift as compared to the calibrant could be accounted properly. With this regard, a routine based on machine learning algorithm is being worked on, trying to solve the sample position shift as compared to the calibrant, by utilizing the relative position shift among pixels.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "Kvieta1990/ornl-pd",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./general_aspects\calibration"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="toc.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Calibration of Instruments</p>
      </div>
    </a>
    <a class="right-next"
       href="instrument_files.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Instrument Calibration Files</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hfir">HFIR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto">Howto</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sns">SNS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-principle">Howto - principle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-nomad">Howto - NOMAD</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#howto-powgen">Howto - POWGEN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calibration-some-notes">Calibration - Some Notes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Usage</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yuanpeng Zhang & the Powder Diffraction Group at ORNL
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>